import"merge";function useContextServer$1(){var n={};return{set:function(e,t){n[e]=t},get:function(e){return n[e]},show:function(){return n}}}var contextServer$1=useContextServer$1();function useMsgServer(){var n={msgInstance:null};return{state:n,init:function(){if(contextServer$1.get("roomInitGroupServer"))return contextServer$1.get("roomInitGroupServer").state.vhallSaasInstance.createChat().then(function(e){return n.msgInstance=e})},destroy:function(){n.msgInstance&&(n.msgInstance.destroy,n.msgInstance=null)},$on:function(e,t){n.msgInstance&&n.msgInstance.$on(e,t)},$emit:function(e,t){n.msgInstance&&n.msgInstance.$emit(e,t)}}}function ownKeys(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,n,i,r,o,a){try{var c=e[o](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(i,r)}function _asyncToGenerator(c){return function(){var e=this,a=arguments;return new Promise(function(t,n){var i=c.apply(e,a);function r(e){asyncGeneratorStep(i,t,n,r,o,"next",e)}function o(e){asyncGeneratorStep(i,t,n,r,o,"throw",e)}r(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function useInteractiveServer(){function e(n){var i=null,r=null,o=null,a=null;return n.getDevices().then(function(e){console.log("devices list::",e),i=e.videoInputDevices.filter(function(e){return e.label&&"desktopScreen"!=e.deviceId}),r=e.audioInputDevices.filter(function(e){return"default"!=e.deviceId&&"communications"!=e.deviceId&&e.label})}).then(function(){var t=/((^VIDEO_PROFILE_(720P|540P|480P|360P)_1$)|(^RTC_VIDEO_PROFILE_(720P|540P|480P|360P)_16x9_M$))/;n.getVideoConstraints(i[0].deviceId).then(function(e){console.log("constrainList",e),o=e.filter(function(e){return t.test(e.label)})}).then(function(){var e={videoNode:"vhall-video",videoDevice:i[0].deviceId,audioDevice:r[0].deviceId,profile:o[0]};n.createLocalVideoStream(e).then(function(e){console.log("create local stream success::",e),c.streamId=e,a=e}).then(function(){n.publishStream({streamId:a}).then(function(e){console.log("publish stream success::",a)}).catch(function(e){console.log("publish is failed::",e)})}).catch(function(e){console.log("local stream failed::",e)})}).catch(function(e){console.log("constrainlist is failed::",e)})}).catch(function(e){console.log("getDevies is failed::",e)})}var c={vhallSaasInstance:null,interactiveInstance:null,streamId:null,remoteStreams:[]},t=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c.interactiveInstance){e.next=2;break}return e.abrupt("return");case 2:return console.log("state:",c.interactiveInstance),e.abrupt("return",c.interactiveInstance.checkSystemRequirements());case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return{state:c,startPushStream:function(){console.log("state:",c),e(c.interactiveInstance)},init:function(e){var t=contextServer$1.get("roomInitGroupServer");return c.vhallSaasInstance=t.state.vhallSaasInstance,c.vhallSaasInstance.createInteractive().then(function(e){return c.interactiveInstance=e,console.log("state.interactiveInstance",e,e.instance),!0})},createLocalStream:function(){return c.interactiveInstance.createLocalStream(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},createLocalVideoStream:function(){return c.interactiveInstance.createLocalVideoStream(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})},createLocaldesktopStream:function(){return c.interactiveInstance.createLocaldesktopStream(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})},createLocalAudioStream:function(){return c.interactiveInstance.createLocalAudioStream(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})},createLocalPhotoStream:function(){return c.interactiveInstance.createLocalPhotoStream(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})},stopStream:function(e){return c.interactiveInstance.destroyStream(c.streamId||e)},publishStream:function(){return c.interactiveInstance.publishStream({streamId:c.streamId||(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).streamId})},unpublishStream:function(e){return c.interactiveInstance.unpublishStream(c.streamId||e)},subscribeStream:function(){return c.interactiveInstance.subscribeStream(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},unSubscribeStream:function(e){return c.interactiveInstance.unSubscribeStream(e)},setDual:function(){return c.interactiveInstance.setDual(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},muteVideo:function(){return c.interactiveInstance.muteVideo(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},muteAudio:function(){return c.interactiveInstance.muteAudio(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},startBroadCast:function(){return c.interactiveInstance.startBroadCast(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})},stopBroadCast:function(){return c.interactiveInstance.stopBroadCast()},setBroadCastLayout:function(){return c.interactiveInstance.setBroadCastLayout(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},setBroadCastScreen:function(){return c.interactiveInstance.setBroadCastScreen(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"")},getDevices:function(){return c.interactiveInstance.getDevices()},getCameras:function(){return c.interactiveInstance.getCameras()},getMicrophones:function(){return c.interactiveInstance.getMicrophones()},getSpeakers:function(){return c.interactiveInstance.getSpeakers()},getVideoConstraints:function(){return c.interactiveInstance.getSpeakers(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"")},isScreenShareSupported:function(){return c.interactiveInstance.isScreenShareSupported()},checkSystemRequirements:t,getPacketLossRate:function(){return c.interactiveInstance.getPacketLossRate()},getRoomStreams:function(){return c.interactiveInstance.getRoomStreams()},remoteStreamList:function(){for(var e in c.remoteStreams=c.interactiveInstance.getRemoteStreams(),c.interactiveInstance.getRemoteStreams())c.remoteStreams.push(e);return c.remoteStreams}}}!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){function i(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach(function(e){s(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=l(n);return f(this,i?(e=l(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function e(n){return new Promise(function(e){var t=document.createElement("script");document.head.appendChild(t),t.src=n,t.onload=function(){e()}})}var v="",h="",m="",p=null;function y(e){v=e}function g(n){return n.url=v+n.url,console.log("接口环境",n.url),new Promise(function(e,t){(n=n||{}).data&&(m&&(n.data.live_token=m),n.data=function(e){var t=[];if(e)for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(n.data)),(n.dataType?function(e,t,n){var i=e.dataType;e.callback=i;var r=document.createElement("script");r.type="text/javascript",r.charset="utf-8",document.body.appendChild(r),window[i]=function(e){document.body.removeChild(r),clearTimeout(r.timer),window[i]=null,t&&t(e)},r.src="".concat(e.url,"?").concat(e.data,"&_=",1594014089800),e.time&&(r.timer=setTimeout(function(){window[i]=null,head.removeChild(r),n&&n("请求超时")},1e3*parmas.time))}:function(e,i,r){var o=null;e.type=(e.type||"GET").toUpperCase(),o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");o.onreadystatechange=function(){var e,t,n;4==o.readyState&&(200<=(e=o.status)&&e<300?(n="",n=-1!==(t=o.getResponseHeader("Content-type")).indexOf("xml")&&o.responseXML?o.responseXML:"application/json"===t||"application/json;charset=UTF-8"===t?JSON.parse(o.responseText):o.responseText,i&&i(n)):r&&r(e))},"GET"==e.type?e.data?o.open(e.type,e.url+"?"+e.data,!0):o.open(e.type,e.url,!0):"POST"==e.type&&o.open(e.type,e.url,!0);o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),m||h&&o.setRequestHeader("token",h);p&&Object.getOwnPropertyNames(p).forEach(function(e){o.setRequestHeader(e,p[e])});"GET"==e.type?o.send(null):o.send(e.data)})(n,e,t)})}function _(e){return{webinar:{type:(e=e.data).webinar.type,id:e.webinar.id},paasInfo:{channel_id:e.interact.channel_id,inav_id:e.interact.inav_id,paas_access_token:e.interact.paas_access_token,paas_app_id:e.interact.paas_app_id,room_id:e.interact.room_id},userInfo:{avatar:e.join_info.avatar,is_gag:e.join_info.is_gag,is_kick:e.join_info.is_kick,join_id:e.join_info.join_id,nickname:e.join_info.nickname,role_name:e.join_info.role_name,third_party_user_id:e.join_info.third_party_user_id},reportData:{guid:e.report_data.guid,aid:e.interact.room_id,report_extra:e.report_data.report_extra}}}var I=new(function(){function e(){r(this,e),this.state={}}return c(e,[{key:"set",value:function(e,t){this.state[e]=t}},{key:"get",value:function(e){return this.state[e]}}]),e}());function S(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var E,w,T={exports:{}};function b(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return k.apply(void 0,e)}function k(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return C(!0===e[0],!1,e)}function P(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return C(!0===e[0],!0,e)}function D(e){if(Array.isArray(e)){for(var t=[],n=0;n<e.length;++n)t.push(D(e[n]));return t}if(O(e)){t={};for(n in e)t[n]=D(e[n]);return t}return e}function O(e){return e&&"object"===t(e)&&!Array.isArray(e)}function C(e,t,n){var i;!e&&O(i=n.shift())||(i={});for(var r=0;r<n.length;++r){var o,a=n[r];if(O(a))for(var c in a)"__proto__"!==c&&"constructor"!==c&&"prototype"!==c&&(o=e?D(a[c]):a[c],i[c]=t?function e(t,n){if(!O(t))return n;for(var i in n)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(t[i]=O(t[i])&&O(n[i])?e(t[i],n[i]):n[i]);return t}(i[c],o):o)}return i}w=(E=T).exports,Object.defineProperty(w,"__esModule",{value:!0}),w.isPlainObject=w.clone=w.recursive=w.merge=w.main=void 0,E.exports=w=b,w.default=b,(w.main=b).clone=D,b.isPlainObject=O,b.recursive=P,w.merge=k,w.recursive=P,w.clone=D,w.isPlainObject=O;var R=S(T.exports);function A(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=!0,i=0;i<t.length;i++)if(0<e.indexOf(t[i])){n=!1;break}return n}var L={initSendLive:function(e){var i={webinar_id:e.webinarId,live_token:e.live_token||"",nickname:e.nickname||"",email:e.email||"",biz_id:e.biz_id||""};return new Promise(function(t,n){g({url:"/v3/webinars/live/init",type:"GET",data:i}).then(function(e){t(e)}).catch(function(e){return n(e)})})},initStandardReceiveLive:function(e){var i={webinar_id:e.webinarId,visitor_id:e.visitor_id||"",record_id:e.record_id||"",refer:e.refer||"",biz_id:e.biz_id||""};return new Promise(function(t,n){g({url:"/v3/webinars/watch/init",type:"GET",data:i}).then(function(e){t(e)}).catch(function(e){return n(e)})})},initEmbeddedReceiveLive:function(e){var i={webinar_id:e.webinarId,visitor_id:e.visitor_id||"",record_id:e.record_id||"",email:e.email||"",nickname:e.nickname||"",k:e.k||"",state:e.state||"",refer:e.refer||"",sign:e.sign||"",ts:e.ts||"",biz_id:e.biz_id||""};return new Promise(function(t,n){g({url:"/v3/webinars/watch/inline-init",type:"GET",data:i}).then(function(e){t(e)}).catch(function(e){return n(e)})})},initSdkReceiveLive:function(e){var i={webinar_id:e.webinarId,record_id:e.record_id||"",email:e.email||"",nickname:e.nickname||"",pass:e.pass||"",k:e.k||"",refer:e.refer||"",qrcode:e.qrcode||"",share_id:e.share_id||"",visitor_id:e.visitor_id||"",biz_id:e.biz_id||""};return new Promise(function(t,n){g({url:"/v3/webinars/watch/sdk-init",type:"GET",data:i}).then(function(e){t(e)}).catch(function(e){return n(e)})})},startLive:function(e){var t=I.get("roomInitData").webinar,t={webinar_id:(void 0===t?{}:t).id},i=R.recursive({},t,e);return new Promise(function(t,n){g({url:"/v3/webinars/live/start",type:"POST",data:i}).then(function(e){return t(e)}).catch(function(e){return n(e)})})},endLive:function(e){var t=I.get("roomInitData").webinar,t={webinar_id:(void 0===t?{}:t).id},i=R.recursive({},t,e);return new Promise(function(t,n){g({url:"/v3/webinars/live/end",type:"POST",data:i}).then(function(e){return t(e)}).catch(function(e){return n(e)})})},checkLive:function(e){var t=I.get("roomInitData").webinar,t={webinar_id:(void 0===t?{}:t).id},i=R.recursive({},t,e);return new Promise(function(t,n){g({url:"/v3/webinars/live/check",type:"GET",data:i}).then(function(e){return t(e)}).catch(function(e){return n(e)})})},getChatInitOptions:function(e){var t=I.get("roomInitData").webinar,t={webinar_id:(void 0===t?{}:t).id},i=R.recursive({},t,e);return new Promise(function(t,n){g({url:"/v3/webinars/live/get-connect",type:"GET",data:i}).then(function(e){return t(e)}).catch(function(e){return n(e)})})},liveHeartBeat:function(e){return new Promise(function(t,n){g({url:"/v3/webinars/live/heartbeat",type:"GET",data:e}).then(function(e){return t(e)}).catch(function(e){return n(e)})})},getLiveToken:function(e){var t=I.get("roomInitData").webinar,t={webinar_id:(void 0===t?{}:t).id},i=R.recursive({},t,e);return new Promise(function(t,n){g({url:"/v3/webinars/live/get-live-token",type:"GET",data:i}).then(function(e){return t(e)}).catch(function(e){return n(e)})})},getStreamPushAddress:function(e){var t=I.get("roomInitData").webinar,t={webinar_id:(void 0===t?{}:t).id},i=R.recursive({},t,e);return new Promise(function(t,n){g({url:"/v3/webinars/live/get-stream-push-address",type:"GET",data:i}).then(function(e){return t(e)}).catch(function(e){return n(e)})})}},N=new function e(){r(this,e),this.live=L},V=function(){function e(){r(this,e),s(this,"handlers",{})}return c(e,[{key:"$on",value:function(e,t){e in this.handlers||(this.handlers[e]=[]),this.handlers[e].push(t)}},{key:"$emit",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(!(e in this.handlers))return new Error("未注册该事件");this.handlers[e].forEach(function(e){e.apply(void 0,n)})}},{key:"$off",value:function(e,t){if(!(e in this.handlers))return new Error("无效事件");if(t){var n=this.handlers[e].findIndex(function(e){return e===t});if(void 0===n)return new Error("无该绑定事件");this.handlers[e].splice(n,1),0===this.handlers[e].length&&delete this.handlers[e]}else delete this.handlers[e]}}]),e}(),M=function(){u(t,V);var e=d(t);function t(){return r(this,t),e.call(this)}return c(t,[{key:"init",value:function(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.initDefaultOptions(),i=R.recursive({},t,e);return new Promise(function(t,e){VhallChat.createInstance(i,function(e){n.instance=e.message,n.listenEvents(),t(e)},e)})}},{key:"destroy",value:function(){this.instance.destroy(),this.instance=null}},{key:"initDefaultOptions",value:function(){var e=A(),t=I.get("roomInitData"),n=t.paasInfo,t=t.userInfo;return{context:{nick_name:t.nickname,avatar:t.avatar,role_name:t.role_name,device_type:e?"2":"1",device_status:"0",is_banned:t.is_gag,watch_type:e?"1":"2",is_kick:t.is_kick},appId:n.paas_app_id,accountId:t.third_party_user_id,channelId:n.channel_id,token:n.paas_access_token,hide:!1}}},{key:"listenEvents",value:function(){var t=this;this.instance.onRoomMsg(function(e){t.$emit("ROOM_MSG",e)}),this.instance.onChat(function(e){t.$emit("CHAT",e)}),this.instance.onCustomMsg(function(e){t.$emit("CUSTOM_MSG",e)}),this.instance.onOffLine(function(){t.$emit("OFFLINE")}),this.instance.onOnLine(function(){t.$emit("ONLINE")}),this.instance.onDocMsg(function(e){t.$emit("DOC_MSG")}),this.instance.join(function(e){t.$emit("JOIN",e)}),this.instance.leave(function(e){t.$emit("LEFT",e)})}},{key:"emitTextChat",value:function(n){var i=this;return new Promise(function(e,t){i.instance.emitChat(n,e,t)})}},{key:"emitCustomChat",value:function(e){return this.instance.emitCustomMsg(e)}},{key:"emitDocMsg",value:function(e){return this.instance.emitDocMsg(e)}},{key:"emitRoomMsg",value:function(e){e=JSON.stringify(e);return this.instance.emitRoomMsg(e)}},{key:"getUserListInfo",value:function(e){var n=this,i=R.recursive({},{currPage:1,pageSize:10},e);return new Promise(function(e,t){n.instance.getUserListInfo(i,e,t)})}},{key:"setUserDisable",value:function(i){return new Peomise(function(e,t){var n={type:VhallChat.TYPE_DISABLE,targetId:i};chat.setDisable(n,e,t)})}},{key:"setUserPermit",value:function(i){return new Peomise(function(e,t){var n={type:VhallChat.TYPE_PERMIT,targetId:i};chat.setDisable(n,e,t)})}},{key:"setChannelDisable",value:function(){return new Peomise(function(e,t){var n={type:VhallChat.TYPE_DISABLE_ALL};chat.setDisable(n,e,t)})}},{key:"setChannelPermit",value:function(){return new Peomise(function(e,t){var n={type:VhallChat.TYPE_PERMIT_ALL};chat.setDisable(n,e,t)})}},{key:"getHistoryList",value:function(e){var n=this,i=R.recursive({},{currPage:1,pageSize:200},e);return new Promise(function(e,t){n.instance.getHistoryList(i,e,t)})}},{key:"getOnlineInfo",value:function(e){var n=this,i=R.recursive({},{currPage:1,pageSize:200},e);return new Promise(function(e,t){n.instance.getOnlineInfo(i,e,t)})}}]),t}(),j=function(){function t(){var e;return r(this,t),e.instance=null,e.children=[],f(e)}return u(t,V),d(t),c(t,[{key:"init",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=this.initDefaultOptions(),t=R.recursive({},n,t);this.instance=VHDocSDK.createInstance(t,function(){console.log("saasSDK文档初始化成功"),e.$emit(CONST_VAL.DOC_SDK_READ,e.instance)},function(){console.error("saasSDK文档初始化失败",failed.msg),e.$emit(CONST_VAL.DOC_SDK_ERROR,failed.msg)}),this.listenEvents()}},{key:"initDefaultOptions",value:function(){A();var e=I.get("roomInitData"),t=e.paasInfo,e=e.userInfo;return{accountId:e.third_party_user_id,roomId:t.room_id,channelId:t.channel_id,appId:t.paas_app_id,role:e.role_name,isVod:!1,client:window.VHDocSDK.Client.PC_WEB,token:this.token}}},{key:"listenEvents",value:function(){var n=this;this.instance.on(VHDocSDK.Event.CREATE_CONTAINER,function(e){}),this.instance.on(VHDocSDK.Event.SELECT_CONTAINER,function(e){}),this.instance.on(VHDocSDK.Event.DOCUMENT_LOAD_COMPLETE,function(e){}),this.instance.on(VHDocSDK.Event.SWITCH_CHANGE,function(e){n.$emit("SWITCH_CHANGE",e)}),this.instance.on(VHDocSDK.Event.DELETE_CONTAINER,function(e){n.$emit("DELETE_CONTAINER")}),this.instance.on(VHDocSDK.Event.ALL_COMPLETE,function(){n.$emit("ALL_COMPLETE")}),this.instance.on(VHDocSDK.Event.DOCUMENT_NOT_EXIT,function(e){var t=e.cid,e=e.docId;n.$emit("DOCUMENT_NOT_EXIT",{cid:t,docId:e})}),this.instance.on(VHDocSDK.Event.PAGE_CHANGE,function(e){n.$emit("PAGE_CHANGE\b",e)}),this.instance.on(VHDocSDK.Event.VOD_CUEPOINT_LOAD_COMPLETE,function(e){n.$emit("VOD_CUEPOINT_LOAD_COMPLETE",e)}),this.instance.on(VHDocSDK.Event.PLAYBACKCOMPLETE,function(e){n.$emit("PLAYBACKCOMPLETE",e)})}},{key:"destroy",value:function(){this.instance&&(this.instance.destroy(),this.instance=null)}},{key:"createBoard",value:function(e){var t={elId:this.instance.createUUID("board"),width:200,height:200,backgroundColor:"RGBA",noDispatch:!1,option:{graphicType:VHDocSDK.GRAPHIC.PEN,stroke:"#000",strokeWidth:4}},e=R.recursive({},t,e);this.instance.createBoard(e)}},{key:"creatDocument",value:function(e){var t=sdk.createUUID("document"),t=(s(t={id:e.id,docId:e.docId,elId:t,width:200,height:200},"docId","yyy"),s(t,"noDispatch",!1),s(t,"option",{graphicType:VHDocSDK.GRAPHIC.PEN,stroke:"#000",strokeWidth:4}),t);R.recursive({},t,e),sdk.createDocument(opts)}},{key:"selectContainer",value:function(e){this.instance.selectContainer({id:e}),this.currentCid=e}},{key:"addChild",value:function(e){this.children.push(e)}},{key:"zoomIn",value:function(){this.instance.zoomIn()}},{key:"zoomOut",value:function(){this.instance.zoomOut()}},{key:"zoomReset",value:function(){this.instance.zoomReset()}},{key:"move",value:function(){this.instance.move()}},{key:"prevStep",value:function(){this.instance.prevStep()}},{key:"nextStep",value:function(){this.instance.nextStep()}}]),t}(),$=function(){u(i,V);var n=d(i);function i(e){var t;return r(this,i),(t=n.call(this,e)).init(e),t}return c(i,[{key:"init",value:function(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){};console.log("customoptions",e),console.log("store",I);var t={appId:I.get("roomInitData").paasInfo.paas_app_id,inavId:I.get("roomInitData").paasInfo.inav_id,roomId:I.get("roomInitData").paasInfo.room_id,accountId:I.get("roomInitData").userInfo.third_party_user_id,token:I.get("roomInitData").paasInfo.paas_access_token,mode:VhallRTC.MODE_RTC,role:VhallRTC.ROLE_HOST,attributes:"",autoStartBroadcast:1==I.get("roomInitData").userInfo.role_name,broadcastConfig:1==I.get("roomInitData").userInfo.role_name?{layout:e.layout||VhallRTC.CANVAS_LAYOUT_PATTERN_FLOAT_6_5D,profile:e.profile||VhallRTC.BROADCAST_VIDEO_PROFILE_1080P_1,paneAspectRatio:VhallRTC.BROADCAST_PANE_ASPACT_RATIO_16_9,border:e.border||{width:2,color:"0x666666"}}:{}},a=R.recursive({},t,e);return console.log("optionssssssssssssssssssssssssssss",a),new Promise(function(t,n){VhallRTC.createInstance(a,function(e){i.instance=e.vhallrtc,i.listenEvents(),console.log("init interactive sdk success:",e),r(e),t(e)},function(e){console.log("fail:",e),o(e),n(e)})})}},{key:"listenEvents",value:function(){var t=this;this.instance.on(VhallRTC.EVENT_REMOTESTREAM_ADD,function(e){t.$emit("interactive_REMOTESTREAM_ADD",e)}),this.instance.on(VhallRTC.EVENT_REMOTESTREAM_REMOVED,function(e){t.$emit("interactive_REMOTESTREAM_REMOVED",e)}),this.instance.on(VhallRTC.EVENT_ROOM_EXCDISCONNECTED,function(e){t.$emit("interactive_ROOM_EXCDISCONNECTED",e)}),this.instance.on(VhallRTC.EVENT_REMOTESTREAM_MUTE,function(e){t.$emit("interactive_REMOTESTREAM_MUTE",e)}),this.instance.on(VhallRTC.EVENT_REMOTESTREAM_FAILED,function(e){t.$emit("interactive_REMOTESTREAM_FAILED",e)}),this.instance.on(VhallRTC.EVENT_STREAM_END,function(e){t.$emit("interactive_STREAM_END",e)}),this.instance.on(VhallRTC.EVENT_STREAM_STUNK,function(e){t.$emit("interactive_STREAM_STUNK",e)}),this.instance.on(VhallRTC.EVENT_DEVICE_CHANGE,function(e){t.$emit("interactive_DEVICE_CHANGE",e)})}},{key:"destroyInit",value:function(){var n=this;return new Promise(function(e,t){n.instance.destroyInstance({}).then(function(){e(),n.instance=null}).catch(function(e){t(e)})})}},{key:"createLocalStream",value:function(){var e=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,n){e.instance.createStream(i).then(function(e){t(e.streamId)}).catch(function(e){var t;1!=I.get("roomInitData").userInfo.role_name?(t=a({roleName:I.get("roomInitData").userInfo.role_name,accountId:I.get("roomInitData").userInfo.third_party_user_id,nickName:I.get("roomInitData").userInfo.nickname},e),n(t)):n(e)})})}},{key:"createLocalVideoStream",value:function(){var i=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(t,n){var e={videoNode:r.videoNode,audio:!0,video:!0,audioDevice:r.audioDevice,videoDevice:r.videoDevice,profile:VhallRTC[r.profile]||VhallRTC.RTC_VIDEO_PROFILE_1080P_16x9_H,streamType:2,attributes:JSON.stringify({roleName:I.get("roomInitData").userInfo.role_name,accountId:I.get("roomInitData").userInfo.third_party_user_id,nickName:I.get("roomInitData").userInfo.nickname})},e=R.recursive({},e,o);console.log("pass params::",e),i.instance.createStream(e).then(function(e){t(e.streamId)}).catch(function(e){var t;1!=I.get("roomInitData").userInfo.role_name?(t=a({roleName:I.get("roomInfo").roleName,accountId:I.get("roomInfo").accountId,nickName:I.get("roomInfo").nickName},e),n(t)):n(e)})})}},{key:"createLocaldesktopStream",value:function(){var i=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(t,n){var e={videoNode:r.videoNode,screen:!0,speaker:r.speaker||!1,profile:r.profile||VhallRTC.RTC_VIDEO_PROFILE_1080P_16x9_H,streamType:3,attributes:JSON.stringify({roleName:I.get("roomInitData").userInfo.role_name,accountId:I.get("roomInitData").userInfo.third_party_user_id,nickName:I.get("roomInitData").userInfo.nickname})},e=R.recursive({},e,o);i.instance.createStream(e).then(function(e){t(e.streamId)}).catch(function(e){var t;1!=I.get("roomInitData").userInfo.role_name?(t=a({roleName:I.get("roomInitData").userInfo.role_name,accountId:I.get("roomInitData").userInfo.third_party_user_id,nickName:I.get("roomInitData").userInfo.nickname},e),n(t)):n(e)})})}},{key:"createLocalAudioStream",value:function(){var i=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(t,n){var e={videoNode:r.videoNode,audio:!0,video:!1,audioDevice:r.audioDevice,showControls:!1,attributes:JSON.stringify({account_id:I.get("roomInfo").accountId,nick_name:I.get("roomInfo").nickName,role_name:I.get("roomInfo").roleName}),streamType:0},e=R.recursive({},e,o);i.instance.createStream(e).then(function(e){t(e.streamId)}).catch(function(e){n(e)})})}},{key:"createLocalPhotoStream",value:function(){var i=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(t,n){var e={videoNode:r.videoNode,audio:!0,video:!0,videoTrack:r.videoTrack},e=R.recursive({},e,o);i.instance.createStream(e).then(function(e){t(e.streamId)}).catch(function(e){n(e)})})}},{key:"destroyStream",value:function(){var n=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return new Promise(function(e,t){n.instance.destroyStream({streamId:i}).then(function(){e()}).catch(function(e){t(e)})})}},{key:"publishStream",value:function(){var e=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,n){e.instance.publish({streamId:i.streamId,accountId:i.accountId}).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"unpublishStream",value:function(){var n=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return new Promise(function(e,t){n.instance.unpublish({streamId:i}).then(function(){e()}).catch(function(e){t(e)})})}},{key:"subscribeStream",value:function(){var i=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,n){var e={videoNode:r.videoNode,streamId:r.streamId,mute:{audio:r.mute.audio||!1,video:r.mute.audio||!1},dual:r.dual||1},e=R.recursive({},e,addConfig);i.instance.subscribe(e).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"unSubscribeStream",value:function(){var e=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return new Promise(function(t,n){e.instance.unsubscribe({streamId:i}).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"setDual",value:function(){var i=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,n){var e={streamId:r.streamId,dual:r.dual};i.instance.setDual(e).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"muteVideo",value:function(){var i=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,n){var e={streamId:r.streamId,isMute:r.isMute};i.instance.muteVideo(e).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"muteAudio",value:function(){var i=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,n){var e={streamId:r.streamId,isMute:r.isMute};i.instance.muteAudio(e).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"startBroadCast",value:function(){var i=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(e,t){var n={layout:r.layout||VhallRTC.CANVAS_LAYOUT_PATTERN_FLOAT_6_5D,profile:r.profile||VhallRTC.BROADCAST_VIDEO_PROFILE_1080P_1,paneAspectRatio:VhallRTC.BROADCAST_PANE_ASPACT_RATIO_16_9,border:r.border||{width:2,color:"0x666666"}},n=R.recursive({},n,o);i.instance.startBroadCast(n).then(function(){e()}).catch(function(e){t(e)})})}},{key:"stopBroadCast",value:function(){var n=this;return new Promise(function(e,t){n.instance.stopBroadCast().then(function(){e()}).catch(function(e){t(e)})})}},{key:"setBroadCastLayout",value:function(){var n=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(e,t){n.instance.setBroadCastLayout({layout:i.layout||VhallRTC.CANVAS_LAYOUT_PATTERN_FLOAT_6_5D}).then(function(){e()}).catch(function(e){t(e)})})}},{key:"setBroadCastScreen",value:function(){var n=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return new Promise(function(e,t){n.instance.setBroadCastScreen({mainScreenStreamId:i}).then(function(){e()}).catch(function(e){t(e)})})}},{key:"getDevices",value:function(){var e=this;return new Promise(function(t,n){e.instance.getDevices().then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"getCameras",value:function(){var e=this;return new Promise(function(t,n){e.instance.getCameras().then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"getMicrophones",value:function(){var e=this;return new Promise(function(t,n){e.instance.getMicrophones().then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"getSpeakers",value:function(){var e=this;return new Promise(function(t,n){e.instance.getSpeakers().then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"getVideoConstraints",value:function(e){var i=this;return new Promise(function(t,n){i.instance.getVideoConstraints({deviceId:e},function(e){t(e)},function(e){n(e)})})}},{key:"isScreenShareSupported",value:function(){return this.instance.isScreenShareSupported()}},{key:"checkSystemRequirements",value:function(){var e=this;return new Promise(function(t,n){e.instance.checkSystemRequirements().then(function(e){t(e.result)}).catch(function(e){n(e)})})}},{key:"getPacketLossRate",value:function(){var e=this;return new Promise(function(t,n){e.instance.getPacketLossRate().then(function(e){t(e)}).catch(function(e){n(e)})})}}]),i}(),x=function(){u(i,V);var n=d(i);function i(e){var t;return r(this,i),(t=n.call(this,e)).init(e),t.isPlaying=!1,t}return c(i,[{key:"init",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){};"live"===e.type&&this.initLivePlayer(e,t,n),"vod"===e.type&&this.initVodPlayer(e,t,n)}},{key:"createInstance",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){},r=I.get("roomInitData"),o=r.paasInfo,r=r.userInfo,o={appId:o.paas_app_id,accountId:r.third_party_user_id,token:o.paas_access_token,type:"live"},e=R.recursive({},o,e);console.log("options:",e);VhallPlayer.createInstance(e,function(e){t.instance=e.vhallplayer,t.listenEvents(),n(e)},function(e){console.log("fail:",e),i(e)})}},{key:"initLivePlayer",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){},i=I.get("roomInitData"),r=i.paasInfo;i.userInfo;r={type:"live",language:"zh",liveOption:{roomId:r.room_id,forceMSE:!0,type:"flv"}},e=R.recursive({},r,e);this.createInstance(e,t,n)}},{key:"initVodPlayer",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){},e=R.recursive({},{appId:"",accountId:"",token:"",type:"live",vodOption:{forceMSE:!0,recordId:""}},e);this.createInstance(e,t,n)}},{key:"listenEvents",value:function(){var t=this;this.instance.on(VhallPlayer.CURRENTTIME_CHANGE,function(e){t.$emit("CURRENTTIME_CHANGE",e)}),this.instance.on(VhallPlayer.TIMEUPDATE,function(e){t.$emit("TIMEUPDATE",e)}),this.instance.on(VhallPlayer.ENDED,function(e){t.$emit("ENDED",e)}),this.instance.on(VhallPlayer.ERROR,function(e){t.$emit("ERROR",e)}),this.instance.on(VhallPlayer.LOADED,function(e){t.$emit("LOADED",e)}),this.instance.on(VhallPlayer.PLAY,function(e){t.$emit("PLAY",e)}),this.instance.on(VhallPlayer.PAUSE,function(e){t.$emit("PAUSE",e)}),this.instance.on(VhallPlayer.LAG_REPORT,function(e){t.$emit("LAG_REPORT",e)}),this.instance.on(VhallPlayer.LAG_RECOVER,function(e){t.$emit("LAG_RECOVER",e)}),this.instance.on(VhallPlayer.FULLSCREEN_CHANGE,function(e){t.$emit("FULLSCREEN_CHANGE",e)}),this.instance.on(VhallPlayer.MUTE_CHANGE,function(e){t.$emit("MUTE_CHANGE",e)}),this.instance.on(VhallPlayer.LOOP_CHANGE,function(e){t.$emit("LOOP_CHANGE",e)}),this.instance.on(VhallPlayer.DEFINITION_CHANGE,function(e){t.$emit("DEFINITION_CHANGE",e)})}},{key:"destroy",value:function(){this.instance.destroy(),this.instance=null}},{key:"play",value:function(){return this.instance.play()}},{key:"pause",value:function(){return this.instance.pause()}},{key:"isPause",value:function(){return this.instance.getIsPause()}},{key:"getQualitys",value:function(){return this.instance.getQualitys()}},{key:"getCurrentQuality",value:function(){return this.instance.getCurrentQuality()}},{key:"setQuality",value:function(e,t){return this.instance.setQuality(e,t)}},{key:"enterFullScreen",value:function(e){return this.instance.enterFullScreen(e)}},{key:"exitFullScreen",value:function(e){return this.instance.exitFullScreen(e)}},{key:"setMute",value:function(e,t){return this.instance.setMute(e,t)}},{key:"getVolume",value:function(){return this.instance.getVolume()}},{key:"setVolume",value:function(e,t){return this.instance.setVolume(e,t)}},{key:"getDuration",value:function(e){return this.instance.getDuration(e)}},{key:"getCurrentTime",value:function(e){return this.instance.getCurrentTime(e)}},{key:"setCurrentTime",value:function(e,t){return this.instance.setCurrentTime(e,t)}},{key:"getUsableSpeed",value:function(e){return this.instance.getUsableSpeed(e)}},{key:"setPlaySpeed",value:function(e,t){return this.instance.setPlaySpeed(e,t)}},{key:"openControls",value:function(e){return this.instance.openControls(e)}},{key:"openUI",value:function(e){return this.instance.openUI(e)}},{key:"setResetVideo",value:function(){var e=document.getElementById(this.params.videoNode);e&&this.instance&&this.instance.setSize({width:e.offsetWidth,height:e.offsetHeight})}},{key:"setBarrageInfo",value:function(e){return this.instance.setBarrageInfo(e,function(e){Vlog.error(e)})}},{key:"addBarrage",value:function(e){return this.instance.addBarrage(e,function(e){Vlog.error(e)})}},{key:"toggleBarrage",value:function(e){this.instance&&(e?this.instance.openBarrage():this.instance.closeBarrage())}},{key:"toggleSubtitle",value:function(e){this.instance&&this.params.recordId&&(e?this.instance.openSubtitle():this.instance.closeSubtitle())}}]),i}(),T=function(){function e(){r(this,e),this.msgBus=null,this.request=N,this.baseState=I}return c(e,[{key:"init",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{clientType:"send",receiveType:"standard"};return this.setRequestConfig(e),this.setClientType(e.clientType),"send"===e.clientType?this.initSendLive(e):this.initReceiveLive(e)}},{key:"initSendLive",value:function(e){var i=this;return new Promise(function(t,n){i.request.live.initSendLive(e).then(function(e){200===e.code?(I.set("roomInitData",_(e)),t(e)):n(e)})})}},{key:"initReceiveLive",value:function(e){var i=this,r={standard:"initStandardReceiveLive",embed:"initEmbeddedReceiveLive",sdk:"initSdkReceiveLive"};return new Promise(function(t,n){i.request.live[r[e.receiveType]](e).then(function(e){200===e.code?(I.set("roomInitData",_(e)),t(e)):n(e)})})}},{key:"setClientType",value:function(e){if("send"!==e&&"receive"!==e)throw new TypeError("clientType is invalid");I.set("clientType",e)}},{key:"setRequestConfig",value:function(e){var t,n;e.development?y("https://t-saas-dispatch.vhall.com"):y("https://saas-api.vhall.com"),t=e.token,n=e.liveToken,console.log(t,n,888),h=t,m=n,e.requestHeaders&&(e=e.requestHeaders,p=a({},e))}},{key:"isReady",value:function(){return!0===loadSuccess}},{key:"createPlayer",value:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(e,t){e(new x(n))})}},{key:"createInteractive",value:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,e){var n=new $(i);n.init(i).then(function(e){t(n)})})}},{key:"createChat",value:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,e){var n=new M;n.init(i).then(function(e){t(n)})})}},{key:"createDoc",value:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(e,t){e(new j(n))})}}]),e}();T.requestApi=N,Promise.all([e("https://static.vhallyun.com/jssdk/vhall-jssdk-player/latest/vhall-jssdk-player-2.3.8.js"),e("https://static.vhallyun.com/jssdk/vhall-jssdk-chat/latest/vhall-jssdk-chat-2.1.3.js"),e("https://static.vhallyun.com/jssdk/vhall-jssdk-interaction/latest/vhall-jssdk-interaction-2.3.3.js")]).then(function(e){}),window.VhallSaasSDK=T});var BUSE_URL$1="",TOKEN="",LIVETOKEN="",HEADERS$1={};function setBaseUrl(e){BUSE_URL$1=e}function setToken(e,t){console.log(e,t,888),TOKEN=e,LIVETOKEN=t}function setRequestHeaders(e){HEADERS$1=_objectSpread2({},e)}function $fetch$1(n){return n.url=BUSE_URL$1+n.url,console.log("接口环境",n.url),new Promise(function(e,t){(n=n||{}).data&&(LIVETOKEN&&(n.data.live_token=LIVETOKEN),n.data=formatParams$1(n.data)),(n.dataType?jsonp$1:json$1)(n,e,t)})}function json$1(e,i,r){var o=null;e.type=(e.type||"GET").toUpperCase(),(o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){var e,t,n;4==o.readyState&&(200<=(e=o.status)&&e<300?(n="",n=-1!==(t=o.getResponseHeader("Content-type")).indexOf("xml")&&o.responseXML?o.responseXML:"application/json"===t||"application/json;charset=UTF-8"===t?JSON.parse(o.responseText):o.responseText,i&&i(n)):r&&r(e))},"GET"==e.type?e.data?o.open(e.type,e.url+"?"+e.data,!0):o.open(e.type,e.url,!0):"POST"==e.type&&o.open(e.type,e.url,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),LIVETOKEN||TOKEN&&o.setRequestHeader("token",TOKEN),console.log("HEADERS",HEADERS$1),HEADERS$1&&Object.getOwnPropertyNames(HEADERS$1).forEach(function(e){o.setRequestHeader(e,HEADERS$1[e])}),"GET"==e.type?o.send(null):o.send(e.data)}function jsonp$1(e,t,n){var i=e.dataType;e.callback=i;var r=document.createElement("script");r.type="text/javascript",r.charset="utf-8",document.body.appendChild(r),window[i]=function(e){document.body.removeChild(r),clearTimeout(r.timer),window[i]=null,t&&t(e)},r.src="".concat(e.url,"?").concat(e.data,"&_=",1594014089800),e.time&&(r.timer=setTimeout(function(){window[i]=null,head.removeChild(r),n&&n("请求超时")},1e3*parmas.time))}function formatParams$1(e){var t=[];if(e)for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}var getWebinarInfo=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=contextServer$1.get("roomBaseServer").state;return $fetch$1({url:"/v3/webinars/webinar/info",type:"POST",data:{webinar_id:e.webinarId||t.watchInitData.webinar.id,is_no_check:1}})},getConfigList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=contextServer$1.get("roomBaseServer").state;return $fetch$1({url:"/v3/users/permission/get-config-list",type:"POST",data:{webinar_id:e.webinar_id||t.watchInitData.webinar.id,webinar_user_id:e.webinar_user_id||t.watchInitData.webinar.userinfo.user_id,scene_id:e.scene_id||1}})},setDevice=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=contextServer$1.get("roomBaseServer").state;return $fetch$1({url:"/v3/interacts/room/set-device",type:"POST",data:{room_id:e.room_id||t.watchInitData.interact.room_id,status:e.status||1,type:e.type||0}})},roomBase={getWebinarInfo:getWebinarInfo,getConfigList:getConfigList,setDevice:setDevice},BUSE_URL="",HEADERS={};function $fetch(n){return n.url=BUSE_URL+n.url,console.log("接口环境",n.url),new Promise(function(e,t){(n=n||{}).data&&(n.data=formatParams(n.data)),(n.dataType?jsonp:json)(n,e,t)})}function json(e,i,r){var o=null;e.type=(e.type||"GET").toUpperCase(),(o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){var e,t,n;4==o.readyState&&(200<=(e=o.status)&&e<300?(n="",n=-1!==(t=o.getResponseHeader("Content-type")).indexOf("xml")&&o.responseXML?o.responseXML:"application/json"===t||"application/json;charset=UTF-8"===t?JSON.parse(o.responseText):o.responseText,i&&i(n)):r&&r(e))},"GET"==e.type?e.data?o.open(e.type,e.url+"?"+e.data,!0):o.open(e.type,e.url,!0):"POST"==e.type&&o.open(e.type,e.url,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),console.log("HEADERS",HEADERS),HEADERS&&Object.getOwnPropertyNames(HEADERS).forEach(function(e){o.setRequestHeader(e,HEADERS[e])}),"GET"==e.type?o.send(null):o.send(e.data)}function jsonp(e,t,n){var i=e.dataType;e.callback=i;var r=document.createElement("script");r.type="text/javascript",r.charset="utf-8",document.body.appendChild(r),window[i]=function(e){document.body.removeChild(r),clearTimeout(r.timer),window[i]=null,t&&t(e)},r.src="".concat(e.url,"?").concat(e.data,"&_=",1594014089800),e.time&&(r.timer=setTimeout(function(){window[i]=null,head.removeChild(r),n&&n("请求超时")},1e3*parmas.time))}function formatParams(e){var t=[];if(e)for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}function useContextServer(){var n={};return{set:function(e,t){n[e]=t},get:function(e){return n[e]},show:function(){return n}}}var contextServer=useContextServer(),loginInfo=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return contextServer.get("roomBaseServer").state,$fetch({url:"/v3/users/user-consumer/login",type:"POST",data:2==e.way?{way:2,phone:e.usernames,dynamic_code:e.captchas,visitor_id:e.visitor_id}:{way:1,uuid:e.loginKey.uuid,account:e.ruleForm.username,password:e.retPassword,captcha:e.phoneKey,visitor_id:e.visitor_id,remember:e.remember}})},callbackUserInfo=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return contextServer.get("roomBaseServer").state,$fetch({url:"/v3/users/oauth/callback",type:"POST",data:{source:e.source,key:e.captchas,scene_id:e.visitor_id}})},register=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return contextServer.get("roomBaseServer").state,$fetch({url:"/v3/users/oauth/callback",type:"POST",data:_objectSpread2({},e)})},codeCheck=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return contextServer.get("roomBaseServer").state,$fetch({url:"/v3/users/code-consumer/check",type:"POST",data:_objectSpread2({},e)})},resetPassword=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=contextServer.get("useRoomInitGroupServer").state;return $fetch({url:"/v3/users/user-consumer/reset-password",type:"POST",data:Object.assign({},e,{biz_id:t.biz_id||2})})},userBase={loginInfo:loginInfo,callbackUserInfo:callbackUserInfo,register:register,codeCheck:codeCheck,resetPassword:resetPassword},RequestApi=function e(){_classCallCheck(this,e),this.live=window.VhallSaasSDK.requestApi.live,this.roomBase=roomBase,this.user=userBase},requestApi=new RequestApi;function useRoomBaseServer(){function e(e){console.log(contextServer$1.get("useRoomInitGroupServer"));var t=contextServer$1.get("roomInitGroupServer").state;return console.log("init options:",t),t.vhallSaasInstance.init(e).then(function(e){return 200===e.code?(n.inited=!0,n.watchInitData=e.data):n.watchInitErrorData=e,e})}function t(e){return requestApi.roomBase.setDevice(e).then(function(e){return e})}var n={inited:!1,isLiveOver:!1,webinarVo:{},watchInitData:{},watchInitErrorData:void 0,configList:{}};return{state:n,init:e,getWatchInitData:e,getWebinarInfo:function(e){return requestApi.roomBase.getWebinarInfo(e).then(function(e){return n.webinarVo=e.data,e})},getConfigList:function(e){return requestApi.roomBase.getConfigList(e).then(function(e){return n.configList=JSON.parse(e.data.permissions),e})},startLive:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return t(e),requestApi.live.startLive(e)},endLive:function(e){return requestApi.live.endLive(e)},setDevice:t}}function useUserServer(){return{state:{},loginInfo:function(e){return requestApi.user.loginInfo(e)},callbackUserInfo:function(e){return requestApi.user.callbackUserInfo(e)},register:function(e){return requestApi.user.register(e)},codeCheck:function(e){return requestApi.user.codeCheck(e)},resetPassword:function(e){return requestApi.user.resetPassword(e)}}}function useRoomInitGroupServer(){var n={bizId:(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).biz_id||2,vhallSaasInstance:null},r=useRoomBaseServer(),o=useMsgServer(),a=useInteractiveServer();contextServer$1.set("roomBaseServer",r),contextServer$1.set("msgServer",o),contextServer$1.set("interactiveServer",a);function c(e){e.development?setBaseUrl("https://t-saas-dispatch.vhall.com"):setBaseUrl("https://saas-api.vhall.com"),setToken(e.token,e.liveToken),e.requestHeaders&&setRequestHeaders(e.requestHeaders)}function s(){return new Promise(function(e,t){n.vhallSaasInstance=new window.VhallSaasSDK,contextServer$1.set("roomInitGroupServer",u),e()})}var e=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.destroy(),e.next=3,o.init();case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),t=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,i=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<i.length&&void 0!==i[0]?i[0]:{},e.next=3,s();case 3:return n={clientType:"send",development:!0,requestHeaders:{platform:7}},n=Object.assign({},n,t),c(n),e.next=8,r.init(n);case 8:return e.next=10,r.getWebinarInfo();case 10:return e.next=12,r.getConfigList();case 12:return e.next=14,o.init();case 14:return e.next=16,a.init();case 16:return e.abrupt("return",!0);case 17:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),i=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,i=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=0<i.length&&void 0!==i[0]?i[0]:{},s(),t={clientType:"receive",development:!0,requestHeaders:{platform:7},receiveType:"standard"},n=Object.assign({},t,n),c(n),e.next=7,r.init(n);case 7:return e.next=9,r.getWebinarInfo();case 9:return e.next=11,r.getConfigList();case 11:return e.next=13,o.init();case 13:return e.next=15,a.init();case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),u={state:n,roomBaseServer:r,msgServer:o,interactiveServer:a,reload:e,initSendLive:t,initReceiveLive:i};return u}export{contextServer$1 as contextServer,requestApi,useInteractiveServer,useMsgServer,useRoomBaseServer,useRoomInitGroupServer,useUserServer};
//# sourceMappingURL=vhall-saas-domain.es.js.map
